<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Latest Posts &#8211; Linuxdynasty</title>
<meta name="description" content="What I am up too.">
<meta name="keywords" content="Python, GoLang, automation, scripting, programming, vFense, metrics, monitoring">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://linuxdynasty.github.io/Linuxdynasty/images/abstract-1.jpg">

<meta name="twitter:title" content="Latest Posts">
<meta name="twitter:description" content="What I am up too.">
<meta name="twitter:creator" content="@linuxdynasty">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Latest Posts">
<meta property="og:description" content="What I am up too.">
<meta property="og:url" content="http://linuxdynasty.github.io/Linuxdynasty/index.html">
<meta property="og:site_name" content="Linuxdynasty">





<link rel="canonical" href="http://linuxdynasty.github.io/Linuxdynasty/">
<link href="http://linuxdynasty.github.io/Linuxdynasty/feed.xml" type="application/atom+xml" rel="alternate" title="Linuxdynasty Feed">
<link rel="author" href="https://google.com/+AllenSanabria?rel=author">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://linuxdynasty.github.io/Linuxdynasty/assets/css/main.min.css">
<!-- Webfonts -->
<link href="http://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="http://linuxdynasty.github.io/Linuxdynasty/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://linuxdynasty.github.io/Linuxdynasty/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://linuxdynasty.github.io/Linuxdynasty/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://linuxdynasty.github.io/Linuxdynasty/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://linuxdynasty.github.io/Linuxdynasty/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://linuxdynasty.github.io/Linuxdynasty/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://linuxdynasty.github.io/Linuxdynasty/images/apple-touch-icon-144x144-precomposed.png">



</head>

<body id="post-index" class="feature">

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="http://linuxdynasty.github.io/Linuxdynasty">Home</a></li>
		<li>
			<a href="#">About</a>
			<ul class="dl-submenu">
				<li>
					<img src="http://linuxdynasty.github.io/Linuxdynasty/images/avatar.jpg" alt="Allen Sanabria photo" class="author-photo">
					<h4>Allen Sanabria</h4>
					<p>DevOps developer who loves programming, monitoring, automation, and metrics.</p>
				</li>
				<li><a href="http://linuxdynasty.github.io/Linuxdynasty/about/">Learn More</a></li>
				<li>
					<a href="mailto:asanabria <@> linuxdynasty dot org"><i class="fa fa-envelope"></i> Email</a>
				</li>
				<li>
					<a href="http://twitter.com/linuxdynasty"><i class="fa fa-twitter"></i> Twitter</a>
				</li>
				
				<li>
					<a href="https://google.com/+AllenSanabria"><i class="fa fa-google-plus"></i> Google+</a>
				</li>
				<li>
					<a href="http://linkedin.com/in/linuxdynasty"><i class="fa fa-linkedin"></i> LinkedIn</a>
				</li>
				<li>
					<a href="http://github.com/linuxdynasty"><i class="fa fa-github"></i> GitHub</a>
				</li>
				
				
				
				
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">Posts</a>
			<ul class="dl-submenu">
				<li><a href="http://linuxdynasty.github.io/Linuxdynasty/posts/">All Posts</a></li>
				<li><a href="http://linuxdynasty.github.io/Linuxdynasty/tags/">All Tags</a></li>
			</ul>
		</li>
		<li><a href="http://linuxdynasty.github.io/Linuxdynasty"></a></li><li><a href="http://linuxdynasty.github.io/Linuxdynasty"></a></li>
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->


<div class="entry-header">
  <div class="image-credit">Image source: <a href="http://www.dargadgetz.com/ios-7-abstract-wallpaper-pack-for-iphone-5-and-ipod-touch-retina/">dargadgetz</a></div><!-- /.image-credit -->
  
    <div class="entry-image">
      <img src="http://linuxdynasty.github.io/Linuxdynasty/images/abstract-1.jpg" alt="Latest Posts">
    </div><!-- /.entry-image -->
  
  <div class="header-title">
    <div class="header-title-wrap">
      <h1>Linuxdynasty</h1>
      <h2>Latest Posts</h2>
    </div><!-- /.header-title-wrap -->
  </div><!-- /.header-title -->
</div><!-- /.entry-header -->

<div id="main" role="main">
  
<article class="hentry">
  <header>
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2014-10-10T00:00:00-04:00"><a href="http://linuxdynasty.github.io/Linuxdynasty/graph-resque-metrics-using-sensu-and-graphite/">October 10, 2014</a></time></span><span class="author vcard"><span class="fn"><a href="http://linuxdynasty.github.io/Linuxdynasty/about/" title="About Allen Sanabria">Allen Sanabria</a></span></span>&nbsp; &bull; &nbsp;<span class="entry-comments"><a href="http://linuxdynasty.github.io/Linuxdynasty/graph-resque-metrics-using-sensu-and-graphite/#disqus_thread">Comment</a></span>
      
      <span class="entry-reading-time pull-right">
        <i class="fa fa-clock-o"></i>
        
        Reading time ~1 minute
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://linuxdynasty.github.io/Linuxdynasty/graph-resque-metrics-using-sensu-and-graphite/" rel="bookmark" title="Graph resque metrics using sensu and graphite." itemprop="url">Graph resque metrics using sensu and graphite.</a></h1>
    
  </header>
  <div class="entry-content">
    <p>We are using Resque for our background jobs and we use the Resque Web interface
to keep track of what is happening. But the only issue, is that we had no
real insight to how many jobs we were running on average during certain times
of the day. We didn’t know how many jobs we were processing per minute. Nor how 
many workers we had per host all day everyday, which varies depending on the time
of the day.</p>

<h3 id="download-script">Download Script</h3>

<ul>
  <li><a href="https://github.com/linuxdynasty/Linuxdynasty/blob/master/scripts/sensu/metrics/resque_queue_metrics.rb">Resque Metrics</a></li>
</ul>

<h3 id="dependencies">Dependencies</h3>
<ul>
  <li><a href="http://sensuapp.org/">Sensu</a> (shipper)</li>
  <li><a href="http://graphite.wikidot.com/">Graphite</a></li>
  <li><a href="https://github.com/resque/resque">Resque</a></li>
  <li><a href="http://redis.io/">Redis</a></li>
</ul>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">/opt/sensu/embedded/bin/ruby /etc/sensu/plugins/resque_queue_metrics.rb  -h localhost -n <span class="m">15</span> --scheme redis-db01.resque
redis-db01.resque.queue.update_unapplied.workers 1, 1412961997
redis-db01.resque.queue.update_unapplied.jobs <span class="m">0</span> 1412961997
redis-db01.resque.queue.aging.workers 1, 1412961997
redis-db01.resque.queue.aging.jobs <span class="m">0</span> 1412961997
redis-db01.resque.host.worker-host-01.processed <span class="m">90537</span> 1412961997
redis-db01.resque.host.worker-host-01.queues <span class="m">38</span> 1412961997
redis-db01.resque.host.worker-host-01.workers <span class="m">47</span> 1412961997
redis-db01.resque.host.worker-host-02.processed <span class="m">20482</span> 1412961997
redis-db01.resque.host.worker-host-02.queues <span class="m">29</span> 1412961997
redis-db01.resque.host.worker-host-02.workers <span class="m">20</span> 1412961997
redis-db01.resque.host.worker-host-05.processed <span class="m">20560</span> 1412961997
redis-db01.resque.host.worker-host-05.queues <span class="m">1</span> 1412961997
redis-db01.resque.host.worker-host-05.workers <span class="m">9</span> 1412961997
redis-db01.resque.host.worker-host-03.processed <span class="m">10928</span> 1412961997
redis-db01.resque.host.worker-host-03.queues <span class="m">1</span> 1412961997
redis-db01.resque.host.worker-host-03.workers <span class="m">15</span> 1412961997
redis-db01.resque.host.worker-host-04.processed <span class="m">23554</span> 1412961997
redis-db01.resque.host.worker-host-04.queues <span class="m">1</span> 1412961997
redis-db01.resque.host.worker-host-04.workers <span class="m">9</span> 1412961997
redis-db01.resque.failed.communication.Communication.ActiveRecord_RecordNotFound <span class="m">3</span> 1412961997
redis-db01.resque.failed.communication.Communication.Redis_TimeoutError <span class="m">1</span> 1412961997
redis-db01.resque.failed.create_batch.CreateBatch.BatchCreationValidator_Error <span class="m">77</span> 1412961997
redis-db01.resque.failed.create_batch.CreateBatch.RuntimeError <span class="m">5</span> 1412961997
redis-db01.resque.failed.notification.Notification.ActiveRecord_RecordInvalid <span class="m">2</span> 1412961997
redis-db01.resque.failed.notification.Notification.Resque_DirtyExit <span class="m">4</span> 1412961997
redis-db01.resque.failed.notification.Notification.Redis_TimeoutError <span class="m">3</span> 1412961997
redis-db01.resque.failed.message_notifications.MessageTaskJob.RuntimeError <span class="m">2</span> 1412961997
redis-db01.resque.failed.note_upload.NoteUploadJob.HttpClient_AuthorizationError <span class="m">40</span> 1412961997
redis-db01.resque.failed.invitation.InvitationJob.ActiveRecord_RecordInvalid <span class="m">2</span> 1412961997
redis-db01.resque.failed.post.PostJob.Redis_TimeoutError <span class="m">6</span> 1412961997
redis-db01.resque.failed.post.PostJob.Resque_DirtyExit <span class="m">48</span> 1412961997
redis-db01.resque.failed.encounter.EncounterJob.Exception_NoTransitionAllowed <span class="m">1</span> 1412961997
redis-db01.resque.failed.claim_assembly.ClaimAssembly.Redis_TimeoutError <span class="m">2</span> 1412961997
redis-db01.resque.failed.claim_assembly.ClaimAssembly.Resque_DirtyExit <span class="m">3</span> 1412961997
redis-db01.resque.failed.claim_assembly.ClaimAssembly.Exception <span class="m">1</span> 1412961997
redis-db01.resque.failed.balance.Balancer_BalancerJob.Resque_DirtyExit <span class="m">28</span> 1412961997
redis-db01.resque.failed.balance.Balancer_BalanceJob.Redis_TimeoutError <span class="m">1</span> 1412961997
redis-db01.resque.failed.balance.Balancer_BalanceJob.Resque_DirtyExit <span class="m">2</span> 1412961997
redis-db01.resque.queue.failed.jobs   <span class="m">231</span> 1412961997
redis-db01.resque.queues  <span class="m">35</span>  1412961997
redis-db01.resque.workers <span class="m">100</span> 1412961997
redis-db01.resque.working <span class="m">2</span>   1412961997</code></pre></div>

<h3 id="screenshots">Screenshots</h3>

<p>Now you can create dashboards, with enough information, that the developers
will no longer need to ask you what is happening with resque.</p>
<figure>
    &lt;a href=http://linuxdynasty.github.io/Linuxdynasty/assets/failed_resque_jobs.png&gt;&lt;img src=http://linuxdynasty.github.io/Linuxdynasty/assets/failed_resque_jobs.png alt=""&gt;
    <figcaption>&lt;a href=http://linuxdynasty.github.io/Linuxdynasty/assets/failed_resque_jobs.png title="Grafana Failed Resque Jobs"&gt;Grafana Failed Resque Jobs.</figcaption>
</figure>
<p><img src="http://linuxdynasty.github.io/Linuxdynasty/assets/failed_resque_jobs.png" alt="Grafana Failed Resque Jobs" />
<img src="http://linuxdynasty.github.io/Linuxdynasty/assets/resque_jobs_1.png" alt="Grafana Resque Jobs" />
<img src="http://linuxdynasty.github.io/Linuxdynasty/assets/resque_workers.png" alt="Grafana Resque Workers Used" /></p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2014-10-10T00:00:00-04:00"><a href="http://linuxdynasty.github.io/Linuxdynasty/graph-passenger-metrics-using-sensu-and-graphite/">October 10, 2014</a></time></span><span class="author vcard"><span class="fn"><a href="http://linuxdynasty.github.io/Linuxdynasty/about/" title="About Allen Sanabria">Allen Sanabria</a></span></span>
      
      <span class="entry-reading-time pull-right">
        <i class="fa fa-clock-o"></i>
        
        Reading time ~2 minutes
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://linuxdynasty.github.io/Linuxdynasty/graph-passenger-metrics-using-sensu-and-graphite/" rel="bookmark" title="Graph passenger metrics using sensu and graphite." itemprop="url">Graph passenger metrics using sensu and graphite.</a></h1>
    
  </header>
  <div class="entry-content">
    <p>Before I started working here, they were only collecting the common metrics
for passenger (queue, processes, and max processes). After being here a little
over a month, I realized that we were always logging into the nodes
and running watch passenger-status, and watching how much memory
certain passenger workers were consuming and how much time each of these
processes were taking.</p>

<p>I kept telling my team, there had to be a better way of gathering this information.
After a quick glance at passenge-status –help, I hit the gold mine.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">Usage: passenger-status <span class="o">[</span>options<span class="o">]</span> <span class="o">[</span>Phusion Passenger<span class="s1">&#39;s PID]</span>

<span class="s1">Tool for inspecting Phusion Passenger&#39;</span>s internal status.

Options:
        --show<span class="o">=</span>pool<span class="p">|</span>requests<span class="p">|</span>backtraces<span class="p">|</span>xml<span class="p">|</span>union_station
                                     Whether to show the pool<span class="err">&#39;</span>s contents,
                                     the currently running requests,
                                     the backtraces of all threads or an XML
                                     description of the pool.
    -v, --verbose                    Show verbose information.</code></pre></div>

<h3 id="download-script">Download Script</h3>

<ul>
  <li><a href="https://github.com/linuxdynasty/Linuxdynasty/blob/master/scripts/sensu/metrics/passenger_metrics.rb">Passenger Metrics</a></li>
</ul>

<h3 id="dependencies">Dependencies</h3>
<ul>
  <li><a href="http://sensuapp.org/">Sensu</a> (shipper)</li>
  <li><a href="http://graphite.wikidot.com/">Graphite</a></li>
  <li><a href="http://www.nokogiri.org/">NokoGiri</a></li>
</ul>

<h3 id="testing-passenger-status---show-xml">Testing passenger-status –show xml</h3>

<p>If you installed libxml2-utils, the xml will look very nice..
Lets take a quick glance, on what the show xml command will display….</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">passenger-status --show xml
&lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> <span class="nv">encoding</span><span class="o">=</span><span class="s2">&quot;iso8859-1&quot;</span>?&gt;
&lt;info <span class="nv">version</span><span class="o">=</span><span class="s2">&quot;2&quot;</span>&gt;
   &lt;process_count&gt;1&lt;/process_count&gt;
   &lt;max&gt;20&lt;/max&gt;
   &lt;capacity_used&gt;1&lt;/capacity_used&gt;
   &lt;get_wait_list_size&gt;0&lt;/get_wait_list_size&gt;
   &lt;get_wait_list/&gt;
   &lt;supergroups&gt;
      &lt;supergroup&gt;
         &lt;name&gt;/home/deploy/test_app/current&lt;/name&gt;
         &lt;state&gt;READY&lt;/state&gt;
         &lt;get_wait_list_size&gt;0&lt;/get_wait_list_size&gt;
         &lt;capacity_used&gt;1&lt;/capacity_used&gt;</code></pre></div>

<p>Another example of the xml data, but showing you the process data instead…</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">passenger-status --show xml
          &lt;processes&gt;
               &lt;process&gt;
                  &lt;pid&gt;8540&lt;/pid&gt;
                  &lt;sticky_session_id&gt;1653709171&lt;/sticky_session_id&gt;
                  &lt;gupid&gt;167557a-WVPmDSUsnlj&lt;/gupid&gt;
                  &lt;connect_password&gt;l<span class="p">;</span>sdkflskdjfslkfjsaj<span class="p">;</span>flkdjs&lt;/connect_password&gt;
                  &lt;concurrency&gt;1&lt;/concurrency&gt;
                  &lt;sessions&gt;0&lt;/sessions&gt;
                  &lt;busyness&gt;0&lt;/busyness&gt;
                  &lt;processed&gt;102&lt;/processed&gt;
                  &lt;spawner_creation_time&gt;1412922319025804&lt;/spawner_creation_time&gt;
                  &lt;spawn_start_time&gt;1412958391718240&lt;/spawn_start_time&gt;
                  &lt;spawn_end_time&gt;1412958391746191&lt;/spawn_end_time&gt;
                  &lt;last_used&gt;1412958455204460&lt;/last_used&gt;
                  &lt;uptime&gt;1m 5s&lt;/uptime&gt;
                  &lt;life_status&gt;ALIVE&lt;/life_status&gt;
                  &lt;enabled&gt;ENABLED&lt;/enabled&gt;
                  &lt;has_metrics&gt;true&lt;/has_metrics&gt;
                  &lt;cpu&gt;4&lt;/cpu&gt;
                  &lt;rss&gt;171028&lt;/rss&gt;
                  &lt;pss&gt;136789&lt;/pss&gt;
                  &lt;private_dirty&gt;103424&lt;/private_dirty&gt;
                  &lt;swap&gt;0&lt;/swap&gt;
                  &lt;real_memory&gt;103424&lt;/real_memory&gt;
                  &lt;vmsize&gt;642504&lt;/vmsize&gt;</code></pre></div>

<h3 id="running-the-script">Running the script</h3>

<p>As you can see, you can get a wealth of data. Data that will allow you and your
team to easily track down what is happening in you rails/sinatra cluster.</p>

<p>This script was written to work with Sensu and it’s graphite handler.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">/opt/sensu/embedded/bin/ruby /etc/sensu/plugins/passenger_metrics.rb --scheme rails-01.passenger
rails-01.passenger.max_pool_size  <span class="m">50</span>  1412958773
rails-01.passenger.processes  <span class="m">23</span>  1412958773
rails-01.passenger.top_level_queue    <span class="m">0</span>   1412958773
rails-01.passenger._var_www_html_test_api_current.queue    <span class="m">0</span>   1412958773
rails-01.passenger._var_www_html_test_api_current.processes    <span class="m">23</span>  1412958773
rails-01.passenger._var_www_html_test_api_current.processes_being_spawned  <span class="m">0</span>   1412958773
rails-01.passenger._var_www_html_test_api_current.process_1.processed  <span class="m">3567</span>    1412958773
rails-01.passenger._var_www_html_test_api_current.process_1.pid    <span class="m">7703</span>    1412958773
rails-01.passenger._var_www_html_test_api_current.process_1.uptime <span class="m">921</span> 1412958773
rails-01.passenger._var_www_html_test_api_current.process_1.memory <span class="m">909664</span>  1412958773
rails-01.passenger._var_www_html_test_api_current.process_1.cpu_percent    <span class="m">27</span>  1412958773
rails-01.passenger._var_www_html_test_api_current.process_2.processed  <span class="m">2194</span>    1412958773
rails-01.passenger._var_www_html_test_api_current.process_2.pid    <span class="m">11878</span>   1412958773
rails-01.passenger._var_www_html_test_api_current.process_2.uptime <span class="m">659</span> 1412958773
rails-01.passenger._var_www_html_test_api_current.process_2.memory <span class="m">644108</span>  1412958773
rails-01.passenger._var_www_html_test_api_current.process_2.cpu_percent    <span class="m">23</span>  1412958773
rails-01.passenger._var_www_html_test_api_current.process_3.processed  <span class="m">1484</span>    1412958773
rails-01.passenger._var_www_html_test_api_current.process_3.pid    <span class="m">16146</span>   1412958773
rails-01.passenger._var_www_html_test_api_current.process_3.uptime <span class="m">402</span> 1412958773
rails-01.passenger._var_www_html_test_api_current.process_3.memory <span class="m">691392</span>  1412958773
rails-01.passenger._var_www_html_test_api_current.process_3.cpu_percent    <span class="m">32</span>  1412958773
rails-01.passenger._var_www_html_test_api_current.process_4.processed  <span class="m">1343</span>    1412958773
rails-01.passenger._var_www_html_test_api_current.process_4.pid    <span class="m">16738</span>   1412958773
rails-01.passenger._var_www_html_test_api_current.process_4.uptime <span class="m">353</span> 1412958773
rails-01.passenger._var_www_html_test_api_current.process_4.memory <span class="m">521676</span>  1412958773
rails-01.passenger._var_www_html_test_api_current.process_4.cpu_percent    <span class="m">32</span>  1412958773</code></pre></div>

<h3 id="screenshots">Screenshots</h3>

<p>Now you can create dashboards, with enough information, that the developers
will no longer need to ask you what is happening with passenger.</p>

<p><img src="http://linuxdynasty.github.io/Linuxdynasty/assets/passenger_workers.png" alt="Grafana Passenger Workers" />
<img src="http://linuxdynasty.github.io/Linuxdynasty/assets/passenger_queues.png" alt="Grafana Passenger Queues" />
<img src="http://linuxdynasty.github.io/Linuxdynasty/assets/passenger_memory_used.png" alt="Grafana Passenger Memory Used" />
<img src="http://linuxdynasty.github.io/Linuxdynasty/assets/passenger_time_spent.png" alt="Grafana Passenger Time Spent" />
<img src="http://linuxdynasty.github.io/Linuxdynasty/assets/nginx_passenger.png" alt="Grafana Nginx and Passenger dashboard Part 1" /></p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2014-09-26T00:00:00-04:00"><a href="http://linuxdynasty.github.io/Linuxdynasty/graph-nginx-status-codes-in-graphite/">September 26, 2014</a></time></span><span class="author vcard"><span class="fn"><a href="http://linuxdynasty.github.io/Linuxdynasty/about/" title="About Allen Sanabria">Allen Sanabria</a></span></span>
      
      <span class="entry-reading-time pull-right">
        <i class="fa fa-clock-o"></i>
        
        Reading time ~1 minute
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://linuxdynasty.github.io/Linuxdynasty/graph-nginx-status-codes-in-graphite/" rel="bookmark" title="Graph nginx status codes in Graphite." itemprop="url">Graph nginx status codes in Graphite.</a></h1>
    
  </header>
  <div class="entry-content">
    <p>I’m currently at the tail end of collecting metrics for the current company I work for.
We are using a combination of.</p>

<ul>
  <li><a href="http://sensuapp.org/">Sensu</a> (shipper)</li>
  <li><a href="http://graphite.wikidot.com/">Graphite</a>/<a href="https://github.com/etsy/statsd/">StatsD</a> (metrics handler)</li>
  <li><a href="http://grafana.org/">Grafana</a> (Beautiful Dashboards).</li>
</ul>

<p>I built a python script, that leverages the awesome tool <a href="http://linux.die.net/man/8/logtail">logtail</a>
in order to collect http status codes, without consuming too much cpu/ram.</p>

<p>I have tested this script against nginx logs and against 2 different formats (txt and json).</p>

<h3 id="download-script">Download Script</h3>

<ul>
  <li><a href="https://github.com/linuxdynasty/Linuxdynasty/blob/master/scripts/sensu/metrics/nginx-status-code-metrics.py">Nginx Status Code Metrics</a></li>
</ul>

<h3 id="basic-logging">Basic Logging</h3>
<div><div class="CodeRay">
  <div class="code"><pre>&quot;GET /test/foo HTTP/1.0&quot; 200 76288 &quot;-&quot; &quot;Ruby&quot;
</pre></div>
</div>
</div>

<h3 id="json-logging">Json Logging</h3>
<p>I printed the json on multiple lines, but in the log, the json is all in 1 line.</p>

<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
    <span class="nt">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-09-26T08:45:35-04:00&quot;</span><span class="p">,</span>
    <span class="nt">&quot;fields&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;remote_addr&quot;</span><span class="p">:</span> <span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span>
        <span class="nt">&quot;remote_user&quot;</span><span class="p">:</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span>
        <span class="nt">&quot;body_bytes_sent&quot;</span><span class="p">:</span> <span class="s2">&quot;4823&quot;</span><span class="p">,</span>
        <span class="nt">&quot;request_time&quot;</span><span class="p">:</span> <span class="s2">&quot;0.127&quot;</span><span class="p">,</span>
        <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;200&quot;</span><span class="p">,</span>
        <span class="nt">&quot;request&quot;</span><span class="p">:</span> <span class="s2">&quot;POST /rubyamf_gateway/ HTTP/1.0&quot;</span><span class="p">,</span>
        <span class="nt">&quot;request_method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
        <span class="nt">&quot;http_referrer&quot;</span><span class="p">:</span> <span class="s2">&quot;https://foo.bar.net/test/test&quot;</span><span class="p">,</span>
        <span class="nt">&quot;http_user_agent&quot;</span><span class="p">:</span> <span class="s2">&quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/37.0.2062.124 Safari/537.36&quot;</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>The only dependency of this script is logtail which you can install easily on any *nix system.</p>

<ul>
  <li>(Debian/Ubuntu) apt-get install logtail</li>
  <li>(CentOS/RedHat) yum install logtail</li>
</ul>

<p>If you do not have logtail installed you will get the following error</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">{</span>9:45<span class="o">}</span>~/Linuxdynasty/scripts/sensu/metrics:master ✓ python nginx-status-code-metrics.py -h
Please install logtail</code></pre></div>

<p>The following options are available</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">{</span>9:45<span class="o">}</span>~/Linuxdynasty/scripts/sensu/metrics:master ✓ ➭ python nginx-status-code-metrics.py -h
Options:
  -h, --help            show this <span class="nb">help </span>message and <span class="nb">exit</span>
  -d DIRECTORY, --directory<span class="o">=</span>DIRECTORY
                        The directory where the access logs exist
  -f FILE, --file<span class="o">=</span>FILE  name of the access log
  -t FILE_FORMAT, --file_format<span class="o">=</span>FILE_FORMAT
                        json or txt
  -s SCHEME, --scheme<span class="o">=</span>SCHEME
                        the metric naming scheme</code></pre></div>

<p>This is how you would run the script</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">{</span>9:45<span class="o">}</span>~/Linuxdynasty/scripts/sensu/metrics:master ✓ ➭ python nginx-status-code-metrics.py -d /var/log/nginx -f access.json -t json
webserver01.codes.200 <span class="m">1080</span> 1411736116.44
webserver01.codes.304 <span class="m">2</span> 1411736116.44
webserver01.codes.404 <span class="m">19</span> 1411736116.44</code></pre></div>

<p>The end result will look like this.
<img src="http://linuxdynasty.github.io/Linuxdynasty/assets/status_codes.png" alt="Grafana Screenshot" /></p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2014-09-23T00:00:00-04:00"><a href="http://linuxdynasty.github.io/Linuxdynasty/migrated-from-wordpress-to-github-dot-io-pages/">September 23, 2014</a></time></span><span class="author vcard"><span class="fn"><a href="http://linuxdynasty.github.io/Linuxdynasty/about/" title="About Allen Sanabria">Allen Sanabria</a></span></span>
      
      <span class="entry-reading-time pull-right">
        <i class="fa fa-clock-o"></i>
        
        Reading time ~1 minute
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://linuxdynasty.github.io/Linuxdynasty/migrated-from-wordpress-to-github-dot-io-pages/" rel="bookmark" title="Migrated from wordpress to github.io pages" itemprop="url">Migrated from wordpress to github.io pages</a></h1>
    
  </header>
  <div class="entry-content">
    <p>I just finished migrating from wordpress, and I love having the simplicity of 
just managing static pages and being able to edit them right from vim.
I will be updating my old posts little by little, so if a download link is not valid
than just check my <a href="https://github.com/linuxdynasty/Linuxdynasty">GitHub Page</a></p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2014-06-14T11:11:22-04:00"><a href="http://linuxdynasty.github.io/Linuxdynasty/blog/years-silence/">June 14, 2014</a></time></span><span class="author vcard"><span class="fn"><a href="http://linuxdynasty.github.io/Linuxdynasty/about/" title="About Allen Sanabria">Allen Sanabria</a></span></span>&nbsp; &bull; &nbsp;<span class="entry-comments"><a href="http://linuxdynasty.github.io/Linuxdynasty/blog/years-silence/#disqus_thread">Comment</a></span>
      
      <span class="entry-reading-time pull-right">
        <i class="fa fa-clock-o"></i>
        
        Reading time ~1 minute
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://linuxdynasty.github.io/Linuxdynasty/blog/years-silence/" rel="bookmark" title="Two years of silence" itemprop="url">Two years of silence</a></h1>
    
  </header>
  <div class="entry-content">
    <p>I have been so focused on vFense, that I have been negligent of this blog.
vFense has come a long way from it’s inception a little over 20 months ago.
We are still in the Beta, but we are continuously making improvements.
As of right now, I’m currently the only active developer working on the next
major release 0.8.0, which is a complete server rewrite. Examples of what is comming…</p>

<ul>
  <li>All functions, methods, and classes will be fully documented.</li>
  <li>Vulnerability correlation for the following operating systems…
    <ul>
      <li>RedHat and clones</li>
      <li>Ubuntu and clones</li>
      <li>Windows</li>
      <li>CVE/NVD</li>
    </ul>
  </li>
  <li>Moved to using <a href="https://linuxdynasty@bitbucket.org/linuxdynasty/apscheduler.git">APScheduler v3.1.0</a> for managing scheduled jobs</li>
  <li>Logging of all administrative tasks into RethinkDB.</li>
  <li>Remote command line tool for making API calls to vFense (Think of chef’s knife command)</li>
  <li>Token based authentication for the agents</li>
  <li>Separated WEB authentication from Agent authentication.</li>
</ul>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->


<div class="pagination">
  
    Previous
  
  <ul class="inline-list">
    <li>
      
        <span class="current-page">1</span>
      
    </li>
    
      <li>
        
          <a href="http://linuxdynasty.github.io/Linuxdynasty/page2">2</a>
        
      </li>
    
      <li>
        
          <a href="http://linuxdynasty.github.io/Linuxdynasty/page3">3</a>
        
      </li>
    
      <li>
        
          <a href="http://linuxdynasty.github.io/Linuxdynasty/page4">4</a>
        
      </li>
    
      <li>
        
          <a href="http://linuxdynasty.github.io/Linuxdynasty/page5">5</a>
        
      </li>
    
      <li>
        
          <a href="http://linuxdynasty.github.io/Linuxdynasty/page6">6</a>
        
      </li>
    
      <li>
        
          <a href="http://linuxdynasty.github.io/Linuxdynasty/page7">7</a>
        
      </li>
    
      <li>
        
          <a href="http://linuxdynasty.github.io/Linuxdynasty/page8">8</a>
        
      </li>
    
      <li>
        
          <a href="http://linuxdynasty.github.io/Linuxdynasty/page9">9</a>
        
      </li>
    
      <li>
        
          <a href="http://linuxdynasty.github.io/Linuxdynasty/page10">10</a>
        
      </li>
    
      <li>
        
          <a href="http://linuxdynasty.github.io/Linuxdynasty/page11">11</a>
        
      </li>
    
      <li>
        
          <a href="http://linuxdynasty.github.io/Linuxdynasty/page12">12</a>
        
      </li>
    
      <li>
        
          <a href="http://linuxdynasty.github.io/Linuxdynasty/page13">13</a>
        
      </li>
    
      <li>
        
          <a href="http://linuxdynasty.github.io/Linuxdynasty/page14">14</a>
        
      </li>
    
      <li>
        
          <a href="http://linuxdynasty.github.io/Linuxdynasty/page15">15</a>
        
      </li>
    
      <li>
        
          <a href="http://linuxdynasty.github.io/Linuxdynasty/page16">16</a>
        
      </li>
    
      <li>
        
          <a href="http://linuxdynasty.github.io/Linuxdynasty/page17">17</a>
        
      </li>
    
      <li>
        
          <a href="http://linuxdynasty.github.io/Linuxdynasty/page18">18</a>
        
      </li>
    
      <li>
        
          <a href="http://linuxdynasty.github.io/Linuxdynasty/page19">19</a>
        
      </li>
    
      <li>
        
          <a href="http://linuxdynasty.github.io/Linuxdynasty/page20">20</a>
        
      </li>
    
      <li>
        
          <a href="http://linuxdynasty.github.io/Linuxdynasty/page21">21</a>
        
      </li>
    
      <li>
        
          <a href="http://linuxdynasty.github.io/Linuxdynasty/page22">22</a>
        
      </li>
    
      <li>
        
          <a href="http://linuxdynasty.github.io/Linuxdynasty/page23">23</a>
        
      </li>
    
      <li>
        
          <a href="http://linuxdynasty.github.io/Linuxdynasty/page24">24</a>
        
      </li>
    
      <li>
        
          <a href="http://linuxdynasty.github.io/Linuxdynasty/page25">25</a>
        
      </li>
    
      <li>
        
          <a href="http://linuxdynasty.github.io/Linuxdynasty/page26">26</a>
        
      </li>
    
      <li>
        
          <a href="http://linuxdynasty.github.io/Linuxdynasty/page27">27</a>
        
      </li>
    
      <li>
        
          <a href="http://linuxdynasty.github.io/Linuxdynasty/page28">28</a>
        
      </li>
    
      <li>
        
          <a href="http://linuxdynasty.github.io/Linuxdynasty/page29">29</a>
        
      </li>
    
      <li>
        
          <a href="http://linuxdynasty.github.io/Linuxdynasty/page30">30</a>
        
      </li>
    
      <li>
        
          <a href="http://linuxdynasty.github.io/Linuxdynasty/page31">31</a>
        
      </li>
    
  </ul>
  
    <a href="http://linuxdynasty.github.io/Linuxdynasty/page2" class="btn">Next</a>
  
</div><!-- /.pagination -->

</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2014 Allen Sanabria. Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <a href="http://mademistakes.com/hpstr/">HPSTR Theme</a>.</span>
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://linuxdynasty.github.io/Linuxdynasty/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://linuxdynasty.github.io/Linuxdynasty/assets/js/scripts.min.js"></script>

<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-2333243-1', 'auto');  
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');
</script>

          

</body>
</html>