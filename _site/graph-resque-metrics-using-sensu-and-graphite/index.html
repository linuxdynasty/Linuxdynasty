

<!doctype html>
<html lang="en" class="no-js">
  <head>
    

<meta charset="utf-8">



<!-- begin SEO -->









<title>Graph resque metrics using sensu and graphite. - Linuxdynasty</title>







<meta property="og:locale" content="en">
<meta property="og:site_name" content="Linuxdynasty">
<meta property="og:title" content="Graph resque metrics using sensu and graphite.">


  <link rel="canonical" href="http://10.0.0.146:4000/graph-resque-metrics-using-sensu-and-graphite/">
  <meta property="og:url" content="http://10.0.0.146:4000/graph-resque-metrics-using-sensu-and-graphite/">



  <meta property="og:description" content="We are using Resque for our background jobs and we use the Resque Web interfaceto keep track of what is happening. But the only issue, is that we had noreal insight to how many jobs we were running on average during certain timesof the day. We didn’t know how many jobs we were processing per minute. Nor how many workers we had per host all day everyday, which varies depending on the timeof the day.">



  <meta name="twitter:site" content="@linuxdynasty">
  <meta name="twitter:title" content="Graph resque metrics using sensu and graphite.">
  <meta name="twitter:description" content="We are using Resque for our background jobs and we use the Resque Web interfaceto keep track of what is happening. But the only issue, is that we had noreal insight to how many jobs we were running on average during certain timesof the day. We didn’t know how many jobs we were processing per minute. Nor how many workers we had per host all day everyday, which varies depending on the timeof the day.">
  <meta name="twitter:url" content="http://10.0.0.146:4000/graph-resque-metrics-using-sensu-and-graphite/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  

  





  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2014-10-10T00:00:00-07:00">








  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "Allen Sanabria",
      "url" : "http://10.0.0.146:4000",
      "sameAs" : null
    }
  </script>






<!-- end SEO -->


<link href="http://10.0.0.146:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Linuxdynasty Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="http://10.0.0.146:4000/assets/css/main.css">

<meta http-equiv="cleartype" content="on">
    <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->
  </head>

  <body>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <button><div class="navicon"></div></button>
        <ul class="visible-links">
          <li class="masthead__menu-item masthead__menu-item--lg"><a href="http://10.0.0.146:4000/">Linuxdynasty</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://10.0.0.146:4000/">Home</a></li>
          
        </ul>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    





<div id="main" role="main">
  


  <div class="sidebar sticky">
  



<div itemscope itemtype="http://schema.org/Person">

  <div class="author__avatar">
    
    	<img src="http://10.0.0.146:4000/images/avatar.jpg" class="author__avatar" alt="Allen Sanabria">
    
  </div>

  <div class="author__content">
    <h3 class="author__name">Allen Sanabria</h3>
    <p class="author__bio">Systems admin who loves programming, monitoring, automation, and metrics.</p>
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li><i class="fa fa-fw fa-map-marker" aria-hidden="true"></i> Somewhere HOT</li>
      
      
      
        <li><a href="mailto:asanabria <@> linuxdynasty dot org"><i class="fa fa-fw fa-envelope-square" aria-hidden="true"></i> Email</a></li>
      
      
        <li><a href="https://keybase.io/linuxdynasty"><i class="fa fa-fw fa-key" aria-hidden="true"></i> Keybase</a></li>
      
      
        <li><a href="https://twitter.com/linuxdynasty"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
      
      
      
        <li><a href="https://plus.google.com/+AllenSanabria"><i class="fa fa-fw fa-google-plus-square" aria-hidden="true"></i> Google+</a></li>
      
      
        <li><a href="https://www.linkedin.com/in/linuxdynasty"><i class="fa fa-fw fa-linkedin-square" aria-hidden="true"></i> LinkedIn</a></li>
      
      
      
      
      
        <li><a href="https://bitbucket.org/linuxdynasty"><i class="fa fa-fw fa-bitbucket" aria-hidden="true"></i> Bitbucket</a></li>
      
      
        <li><a href="https://github.com/linuxdynasty"><i class="fa fa-fw fa-github" aria-hidden="true"></i> Github</a></li>
      
      
        <li><a href="https://www.stackoverflow.com/users/3511210/linuxdynasty"><i class="fa fa-fw fa-stack-overflow" aria-hidden="true"></i> Stackoverflow</a></li>
      
      
      
      
      
      
      
      
      
      
      
      
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Graph resque metrics using sensu and graphite.">
    <meta itemprop="description" content="We are using Resque for our background jobs and we use the Resque Web interfaceto keep track of what is happening. But the only issue, is that we had noreal insight to how many jobs we were running on average during certain timesof the day. We didn’t know how many jobs we were processing per minute. Nor how many workers we had per host all day everyday, which varies depending on the timeof the day.">
    <meta itemprop="datePublished" content="October 10, 2014">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">Graph resque metrics using sensu and graphite.
</h1>
          
            <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  
	  1 minute read
	
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        <p>We are using Resque for our background jobs and we use the Resque Web interface
to keep track of what is happening. But the only issue, is that we had no
real insight to how many jobs we were running on average during certain times
of the day. We didn’t know how many jobs we were processing per minute. Nor how 
many workers we had per host all day everyday, which varies depending on the time
of the day.</p>

<h3 id="download-script">Download Script</h3>

<ul>
  <li><a href="https://github.com/linuxdynasty/Linuxdynasty/blob/master/scripts/sensu/metrics/resque_queue_metrics.rb">Resque Metrics</a></li>
</ul>

<h3 id="dependencies">Dependencies</h3>
<ul>
  <li><a href="http://sensuapp.org/">Sensu</a> (shipper)</li>
  <li><a href="http://graphite.wikidot.com/">Graphite</a></li>
  <li><a href="https://github.com/resque/resque">Resque</a></li>
  <li><a href="http://redis.io/">Redis</a></li>
</ul>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">/opt/sensu/embedded/bin/ruby /etc/sensu/plugins/resque_queue_metrics.rb  -h localhost -n 15 --scheme redis-db01.resque
redis-db01.resque.queue.update_unapplied.workers 1, 1412961997
redis-db01.resque.queue.update_unapplied.jobs 0 1412961997
redis-db01.resque.queue.aging.workers 1, 1412961997
redis-db01.resque.queue.aging.jobs 0 1412961997
redis-db01.resque.host.worker-host-01.processed 90537 1412961997
redis-db01.resque.host.worker-host-01.queues 38 1412961997
redis-db01.resque.host.worker-host-01.workers 47 1412961997
redis-db01.resque.host.worker-host-02.processed 20482 1412961997
redis-db01.resque.host.worker-host-02.queues 29 1412961997
redis-db01.resque.host.worker-host-02.workers 20 1412961997
redis-db01.resque.host.worker-host-05.processed 20560 1412961997
redis-db01.resque.host.worker-host-05.queues 1 1412961997
redis-db01.resque.host.worker-host-05.workers 9 1412961997
redis-db01.resque.host.worker-host-03.processed 10928 1412961997
redis-db01.resque.host.worker-host-03.queues 1 1412961997
redis-db01.resque.host.worker-host-03.workers 15 1412961997
redis-db01.resque.host.worker-host-04.processed 23554 1412961997
redis-db01.resque.host.worker-host-04.queues 1 1412961997
redis-db01.resque.host.worker-host-04.workers 9 1412961997
redis-db01.resque.failed.communication.Communication.ActiveRecord_RecordNotFound 3 1412961997
redis-db01.resque.failed.communication.Communication.Redis_TimeoutError 1 1412961997
redis-db01.resque.failed.create_batch.CreateBatch.BatchCreationValidator_Error 77 1412961997
redis-db01.resque.failed.create_batch.CreateBatch.RuntimeError 5 1412961997
redis-db01.resque.failed.notification.Notification.ActiveRecord_RecordInvalid 2 1412961997
redis-db01.resque.failed.notification.Notification.Resque_DirtyExit 4 1412961997
redis-db01.resque.failed.notification.Notification.Redis_TimeoutError 3 1412961997
redis-db01.resque.failed.message_notifications.MessageTaskJob.RuntimeError 2 1412961997
redis-db01.resque.failed.note_upload.NoteUploadJob.HttpClient_AuthorizationError 40 1412961997
redis-db01.resque.failed.invitation.InvitationJob.ActiveRecord_RecordInvalid 2 1412961997
redis-db01.resque.failed.post.PostJob.Redis_TimeoutError 6 1412961997
redis-db01.resque.failed.post.PostJob.Resque_DirtyExit 48 1412961997
redis-db01.resque.failed.encounter.EncounterJob.Exception_NoTransitionAllowed 1 1412961997
redis-db01.resque.failed.claim_assembly.ClaimAssembly.Redis_TimeoutError 2 1412961997
redis-db01.resque.failed.claim_assembly.ClaimAssembly.Resque_DirtyExit 3 1412961997
redis-db01.resque.failed.claim_assembly.ClaimAssembly.Exception 1 1412961997
redis-db01.resque.failed.balance.Balancer_BalancerJob.Resque_DirtyExit 28 1412961997
redis-db01.resque.failed.balance.Balancer_BalanceJob.Redis_TimeoutError 1 1412961997
redis-db01.resque.failed.balance.Balancer_BalanceJob.Resque_DirtyExit 2 1412961997
redis-db01.resque.queue.failed.jobs   231 1412961997
redis-db01.resque.queues  35  1412961997
redis-db01.resque.workers 100 1412961997
redis-db01.resque.working 2   1412961997</code></pre></figure>

<h3 id="screenshots">Screenshots</h3>

<p>Now you can create dashboards, with enough information, that the developers
will no longer need to ask you what is happening with resque.</p>

<figure class="">
    <a href="http://10.0.0.146:4000/assets/failed_resque_jobs.png"><img src="http://10.0.0.146:4000/assets/failed_resque_jobs.png" alt="" /></a>
    <figcaption>Resque failed jobs.</figcaption>
</figure>

<figure class="">
    <a href="http://10.0.0.146:4000/assets/resque_jobs_1.png"><img src="http://10.0.0.146:4000/assets/resque_jobs_1.png" alt="" /></a>
    <figcaption>Resque jobs.</figcaption>
</figure>

<figure class="">
    <a href="http://10.0.0.146:4000/assets/resque_workers.png"><img src="http://10.0.0.146:4000/assets/resque_workers.png" alt="" /></a>
    <figcaption>Resque workers.</figcaption>
</figure>

        
      </section>

      <footer class="page__meta">
        
        


  




  
  
  

  <p class="page__taxonomy">
    <strong><i class="fa fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="http://10.0.0.146:4000/tags/#graphite" class="page__taxonomy-item" rel="tag">graphite</a><span class="sep">, </span>
    
      
      
      <a href="http://10.0.0.146:4000/tags/#metrics" class="page__taxonomy-item" rel="tag">metrics</a><span class="sep">, </span>
    
      
      
      <a href="http://10.0.0.146:4000/tags/#redis" class="page__taxonomy-item" rel="tag">redis</a><span class="sep">, </span>
    
      
      
      <a href="http://10.0.0.146:4000/tags/#resque" class="page__taxonomy-item" rel="tag">resque</a><span class="sep">, </span>
    
      
      
      <a href="http://10.0.0.146:4000/tags/#ruby" class="page__taxonomy-item" rel="tag">ruby</a><span class="sep">, </span>
    
      
      
      <a href="http://10.0.0.146:4000/tags/#sensu" class="page__taxonomy-item" rel="tag">sensu</a>
    
    </span>
  </p>




        
          <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Updated:</strong> <time datetime="2014-10-10T00:00:00-07:00">October 10, 2014</time></p>
        
      </footer>

      

<section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=http://10.0.0.146:4000/graph-resque-metrics-using-sensu-and-graphite/" class="btn btn--twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http://10.0.0.146:4000/graph-resque-metrics-using-sensu-and-graphite/" class="btn btn--facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=http://10.0.0.146:4000/graph-resque-metrics-using-sensu-and-graphite/" class="btn btn--google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://10.0.0.146:4000/graph-resque-metrics-using-sensu-and-graphite/" class="btn btn--linkedin" title="Share on LinkedIn"><i class="fa fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>

      


  <nav class="pagination">
    
      <a href="http://10.0.0.146:4000/graph-passenger-metrics-using-sensu-and-graphite/" class="pagination--pager" title="Graph passenger metrics using sensu and graphite.
">Previous</a>
    
    
      <a href="http://10.0.0.146:4000/ansible-filters-and-how-they-can-make-your-playbooks-dynamic/" class="pagination--pager" title="How to use Ansible AWS filters to make your playbooks and roles dynamic.
">Next</a>
    
  </nav>

    </div>

    
      

<div class="page__comments">
  <h4 class="page__comments-title">Leave a Comment</h4>
  
    <section id="disqus_thread"></section>
  
</div>
    
  </article>

  
  
    <div class="page__related">
      
        <h4 class="page__related-title">You May Also Enjoy</h4>
      
      <div class="grid__wrapper">
        
          





<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://10.0.0.146:4000/ansible-filters-and-how-they-can-make-your-playbooks-dynamic/" rel="permalink">How to use Ansible AWS filters to make your playbooks and roles dynamic.
</a>
      
    </h2>
    
      <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  
	  3 minute read
	
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Before I get into how I leverage Filter plugins, 1st let me post a resource about what Filters are in Ansible and how you can leverage them. Common Filter in...</p>
  </article>
</div>
        
          





<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://10.0.0.146:4000/graph-passenger-metrics-using-sensu-and-graphite/" rel="permalink">Graph passenger metrics using sensu and graphite.
</a>
      
    </h2>
    
      <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  
	  1 minute read
	
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Before I started working here, they were only collecting the common metrics
for passenger (queue, processes, and max processes). After being here a little
ov...</p>
  </article>
</div>
        
          





<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://10.0.0.146:4000/migrated-from-wordpress-to-github-dot-io-pages/" rel="permalink">Migrated from wordpress to github.io pages
</a>
      
    </h2>
    
      <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  
	  less than 1 minute read
	
</p>
    
    <p class="archive__item-excerpt" itemprop="description">I just finished migrating from wordpress, and I love having the simplicity of 
just managing static pages and being able to edit them right from vim.
I will ...</p>
  </article>
</div>
        
          





<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://10.0.0.146:4000/python/zenoss/redis/howto-check-redis-availability-stats-redis-py-zenoss-python/" rel="permalink">HowTo check redis availability and get stats using Redis-py, Zenoss, and Python
</a>
      
    </h2>
    
      <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  
	  2 minute read
	
</p>
    
    <p class="archive__item-excerpt" itemprop="description">My team was assigned to create a redis slave status check to be ran under Zenoss.
So while they are creating that check, I decided to google for redis checks...</p>
  </article>
</div>
        
      </div>
    </div>
  
</div>

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        

<div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
      <li><a href="https://twitter.com/linuxdynasty"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
    
    
    
      <li><a href="http://github.com/linuxdynasty"><i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
      <li><a href="http://bitbucket.org/linuxdynasty"><i class="fa fa-fw fa-bitbucket" aria-hidden="true"></i> Bitbucket</a></li>
    
    <li><a href="http://10.0.0.146:4000/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2016 Allen Sanabria. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>
      </footer>
    </div>

    <script src="http://10.0.0.146:4000/assets/js/main.min.js"></script>




  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-2333243-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>






  
  <script type="text/javascript">
  	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  	var disqus_shortname = 'linuxdynasty';

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function() {
  		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  	})();

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function () {
  		var s = document.createElement('script'); s.async = true;
  		s.type = 'text/javascript';
  		s.src = '//' + disqus_shortname + '.disqus.com/count.js';
  		(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  	}());
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>






  </body>
</html>

